<!-- templates/dashboard.html -->
{% extends "base.html" %}
{% block content %}
  <div class="grid">
    <div class="card">
      <div class="badge">Dashboard</div>
      <div class="h1" style="font-size:26px;">Matches</div>
      <p class="p">Total jobs loaded: <b>{{ total }}</b> · Shown: <b>{{ jobs|length }}</b></p>

      <form method="post" action="{{ url_for('scan_now') }}" style="margin: 12px 0;">
        <button type="submit">Scan now</button>
      </form>

      <div class="jobs">
        {% if jobs|length == 0 %}
          <div class="job">
            <h3>No matches yet</h3>
            <div class="meta">Enable sources in Settings and add more keywords/titles.</div>
          </div>
        {% endif %}

        {% for j in jobs %}
          <div class="job">
            <span class="score">Score {{ j["_score"] }}</span>
            <h3>
              {% if j.get("url") %}<a href="{{ j["url"] }}" target="_blank"><u>{{ j["title"] }}</u></a>{% else %}
                {{ j["title"] }}
              {% endif %}
            </h3>
            <div class="meta">{{ j.get("company","") }} · {{ j.get("location","") }}</div>
            <div class="meta">
              Title hits: <code>{{ (j["_why"]["matched_titles"] or []) | join(', ') }}</code><br/>
              Keyword hits: <code>{{ (j["_why"]["matched_keywords"] or []) | join(', ') }}</code><br/>
              Excludes: <code>{{ (j["_why"]["excluded_hits"] or []) | join(', ') }}</code>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>

    <div class="card">
      <div class="badge">Profile snapshot</div>
      <p class="p">
        <b>Target titles:</b> {{ (profile.get("target_titles") or []) | join(", ") }}<br/>
        <b>Keywords:</b> {{ (profile.get("keywords") or []) | join(", ") }}<br/>
        <b>Exclude:</b> {{ (profile.get("exclude_keywords") or []) | join(", ") }}<br/>
      </p>
      <a class="btn primary" href="{{ url_for('settings') }}">Settings</a>
      <a class="btn" href="{{ url_for('profile_redirect') }}">Edit profile</a>
    </div>
  </div>
{% endblock %}
