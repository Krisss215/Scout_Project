<!-- templates/dashboard.html  (REPLACE ENTIRE FILE to add filters UI) -->
{% extends "base.html" %}
{% block content %}
  <div class="grid">
    <div class="card">
      <div class="badge">Dashboard</div>
      <div class="h1" style="font-size:26px;">Matches</div>

      <form class="form" method="get" style="margin-top:12px;">
        <div class="row">
          <div>
            <label>Min score</label>
            <input name="min_score" type="number" value="{{ f_min_score }}" />
          </div>
          <div>
            <label>Location contains</label>
            <input name="location" value="{{ f_location }}" placeholder="e.g., tel aviv" />
          </div>
        </div>
        <label class="pill">
          <input type="checkbox" name="only_new" value="1" {% if f_only_new %}checked{% endif %} />
          Only ðŸ”¥ NEW
        </label>
        <button type="submit">Apply filters</button>
      </form>

      <p class="p" style="margin-top:10px;">
        Total jobs loaded: <b>{{ total }}</b> Â· Shown: <b>{{ jobs|length }}</b><br/>
        Last scan: <code>{{ last_run_at or "never" }}</code> Â· <a href="{{ url_for('logs') }}"><u>Scan logs</u></a>
      </p>

      <form method="post" action="{{ url_for('scan_now') }}" style="margin: 12px 0;">
        {{ csrf_token() }}
        <button type="submit">Scan now</button>
      </form>

      <div class="jobs">
        {% if jobs|length == 0 %}
          <div class="job">
            <h3>No matches</h3>
            <div class="meta">Try lower score or disable Only NEW.</div>
          </div>
        {% endif %}

        {% for j in jobs %}
          <div class="job">
            <span class="score">
              Score {{ j["_score"] }}
              {% if j.get("_is_new") %}
                <span style="margin-left:8px;">ðŸ”¥ NEW</span>
              {% endif %}
            </span>
            <h3>
              {% if j.get("url") %}<a href="{{ j["url"] }}" target="_blank"><u>{{ j["title"] }}</u></a>{% else %}
                {{ j["title"] }}
              {% endif %}
            </h3>
            <div class="meta">{{ j.get("company","") }} Â· {{ j.get("location","") }}</div>
            <div class="meta">First seen: <code>{{ j.get("_first_seen_at") or "â€”" }}</code></div>
          </div>
        {% endfor %}
      </div>
    </div>

    <div class="card">
      <div class="badge">Latest scans</div>
      <div class="small">Last 10 runs</div>
      <div class="jobs" style="margin-top:10px;">
        {% for l in logs %}
          <div class="job">
            <span class="score">{{ l.status }}</span>
            <h3>{{ l.started_at }}</h3>
            <div class="meta">
              sources: {{ l.sources_count }} Â· jobs: {{ l.jobs_fetched }} Â· matches: {{ l.matches_found }} Â· new: {{ l.new_matches }}
            </div>
            {% if l.message %}
              <div class="meta">msg: <code>{{ l.message }}</code></div>
            {% endif %}
          </div>
        {% endfor %}
        {% if logs|length == 0 %}
          <div class="job"><div class="meta">No logs yet.</div></div>
        {% endif %}
      </div>

      <hr />
      <a class="btn primary" href="{{ url_for('settings') }}">Settings</a>
      <a class="btn" href="{{ url_for('account') }}">Account</a>
      <a class="btn" href="{{ url_for('profile_redirect') }}">Edit profile</a>
      <a class="btn" href="{{ url_for('tools_selectors') }}">Selector tool</a>
      <a class="btn" href="{{ url_for('logs') }}">All logs</a>
    </div>
  </div>
{% endblock %}
